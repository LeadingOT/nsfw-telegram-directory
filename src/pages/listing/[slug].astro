---
import BaseLayout from '../../layouts/BaseLayout.astro';
import FAQSection from '../../components/FAQSection.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const listings = await getCollection('listings');
  return listings.map((listing) => ({
    params: { slug: listing.data.slug },
    props: { listing: listing.data },
  }));
}

const { listing } = Astro.props;

const schema = {
  '@context': 'https://schema.org',
  '@type': 'Review',
  name: `${listing.name} Review`,
  description: listing.description,
  url: listing.url,
  itemReviewed: {
    '@type': 'Thing',
    name: listing.name,
    url: listing.url,
  },
  ...(listing.rating && {
    reviewRating: {
      '@type': 'Rating',
      ratingValue: listing.rating,
      bestRating: 5,
    },
  }),
};

const faqs = [
  {
    question: `What is ${listing.name}?`,
    answer: listing.description,
  },
  {
    question: `Is ${listing.name} free to join?`,
    answer: listing.pricing.startingPrice
      ? `${listing.name} offers a ${listing.pricing.model} model starting at ${listing.pricing.startingPrice}.`
      : `${listing.name} is ${listing.pricing.model} to join.`,
  },
  {
    question: `How many members does ${listing.name} have?`,
    answer: listing.members
      ? `${listing.name} has approximately ${listing.members} members.`
      : `${listing.name} has an active membership. Check the channel directly for current member counts.`,
  },
  {
    question: `Is ${listing.name} safe to use?`,
    answer: `As with any Telegram channel, exercise caution. Don't share personal information, use a separate account if privacy is a concern, and be aware that content may be explicit. ${listing.name} is rated ${listing.rating}/5 in our review.`,
  },
];
---

<BaseLayout
  title={`${listing.name} Review ‚Äî Features, Rating & Alternatives`}
  description={listing.tagline}
  schema={schema}
>
  <article class="max-w-3xl">
    <!-- Breadcrumb -->
    <div class="flex items-center gap-2 text-sm text-gray-500 mb-2">
      <a href="/" class="hover:text-purple-400">Home</a>
      <span>/</span>
      <a href={`/category/${listing.category.toLowerCase().replace(/[&+]/g, '').replace(/\s+/g, '-')}`} class="hover:text-purple-400">{listing.category}</a>
      <span>/</span>
      <span class="text-gray-400">{listing.name}</span>
    </div>

    <h1 class="text-3xl font-bold mb-2">{listing.name}</h1>
    <p class="text-lg text-gray-400">{listing.tagline}</p>
    <div class="flex items-center gap-4 mt-2">
      {listing.rating && (
        <span class="text-yellow-500 text-lg">‚òÖ {listing.rating.toFixed(1)} / 5.0</span>
      )}
      {listing.members && (
        <span class="text-gray-500">üë• {listing.members} members</span>
      )}
    </div>

    <!-- Description -->
    <section class="mb-8 mt-6">
      <h2 class="text-xl font-semibold mb-3">Overview</h2>
      <p class="text-gray-300 leading-relaxed">{listing.description}</p>
      <a href={listing.url} target="_blank" rel="noopener nofollow" class="inline-block mt-4 px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
        Open in Telegram ‚Üí
      </a>
    </section>

    <!-- Features -->
    <section class="mb-8">
      <h2 class="text-xl font-semibold mb-3">Key Features</h2>
      <ul class="grid grid-cols-1 md:grid-cols-2 gap-2">
        {listing.features.map((feature: string) => (
          <li class="flex items-center gap-2">
            <span class="text-green-400">‚úì</span>
            <span class="text-gray-300">{feature}</span>
          </li>
        ))}
      </ul>
    </section>

    <!-- Pros & Cons -->
    {(listing.pros || listing.cons) && (
      <section class="mb-8 grid grid-cols-1 md:grid-cols-2 gap-6">
        {listing.pros && (
          <div class="bg-green-950 border border-green-800 rounded-lg p-4">
            <h3 class="text-lg font-semibold mb-2 text-green-400">Pros</h3>
            <ul class="space-y-1">
              {listing.pros.map((pro: string) => (
                <li class="text-sm text-green-300">‚úÖ {pro}</li>
              ))}
            </ul>
          </div>
        )}
        {listing.cons && (
          <div class="bg-red-950 border border-red-800 rounded-lg p-4">
            <h3 class="text-lg font-semibold mb-2 text-red-400">Cons</h3>
            <ul class="space-y-1">
              {listing.cons.map((con: string) => (
                <li class="text-sm text-red-300">‚ùå {con}</li>
              ))}
            </ul>
          </div>
        )}
      </section>
    )}

    <!-- Pricing -->
    <section class="mb-8">
      <h2 class="text-xl font-semibold mb-3">Pricing</h2>
      <div class="bg-gray-900 border border-gray-800 rounded-lg p-4">
        <p><strong>Model:</strong> {listing.pricing.model}</p>
        {listing.pricing.startingPrice && <p><strong>Starting at:</strong> {listing.pricing.startingPrice}</p>}
      </div>
    </section>

    <!-- Tags -->
    <div class="flex flex-wrap gap-2 mb-8">
      {listing.tags.map((tag: string) => (
        <span class="text-xs bg-gray-800 text-gray-400 px-2 py-1 rounded">{tag}</span>
      ))}
    </div>

    <!-- Related Links -->
    <div class="flex gap-4 mb-8 text-sm">
      <a href={`/alternatives/${listing.slug}`} class="text-purple-400 hover:underline">View Alternatives ‚Üí</a>
    </div>

    <!-- FAQ -->
    <FAQSection faqs={faqs} />

    <p class="text-xs text-gray-600 mt-8">Last updated: {listing.lastUpdated}</p>
  </article>
</BaseLayout>
